/*
    --  INTEGRANTES--
  João Victor Michaeli : 555678
  Vinicius Saes : 554456

*/

/*
BEGIN
    FOR t IN (SELECT table_name FROM user_tables) LOOP
        EXECUTE IMMEDIATE 'DROP TABLE ' || t.table_name || ' CASCADE CONSTRAINTS';
    END LOOP;
END;
/
*/

-- DROPS
/*
DROP TABLE tbl_servicos;
DROP TABLE tbl_mecanicas;
DROP TABLE tbl_funcionarios;
DROP TABLE tbl_diagnosticos;
DROP TABLE tbl_veiculos;
DROP TABLE tbl_modelo;
DROP TABLE tbl_clientes;
DROP TABLE tbl_cadastro;
*/



-- TABELA CADASTRO
CREATE TABLE tbl_cadastros (
id_cadastro INTEGER GENERATED BY DEFAULT AS IDENTITY,
usuario VARCHAR(20) NOT NULL,
email VARCHAR(50) NOT NULL,
telefone CHAR(14) NOT NULL,
senha VARCHAR(16) NOT NULL,
nome VARCHAR(30) NOT NULL,
cpf VARCHAR(11),
cnpj VARCHAR(14),
rua VARCHAR(100) NOT NULL,
numero SMALLINT NOT NULL,
complemento VARCHAR(20),
bairro VARCHAR(50) NOT NULL,
cep CHAR(8) NOT NULL,
estado CHAR(2) NOT NULL,
cidade VARCHAR(70) NOT NULL,
tipo CHAR(1) NOT NULL,

CONSTRAINT tbl_cadastro_pk PRIMARY KEY (id_cadastro),
CONSTRAINT tbl_cadastro_un UNIQUE (usuario,email,telefone)
);


INSERT INTO tbl_cadastro(usuario, email, telefone, senha, nome,cpf, rua, numero, complemento, bairro, cep, estado, cidade, tipo)
    VALUES ('joaovictor123', 'joao.victor@email.com', '11987654321', 'senhaSegura123', 'João Victor','91562032097', 'Rua das Flores', '123', 'Apt 45', 'Centro', '01234567', 'SP', 'São Paulo', 'c');
INSERT INTO tbl_cadastro(usuario, email, telefone, senha, nome,cpf, rua, numero, complemento, bairro, cep, estado, cidade, tipo)
    VALUES ('mariasilva88', 'maria.silva@email.com', '21987654321', 'senhaForte2024', 'Maria da Silva','81556638094', 'Avenida Paulista', '456', 'Bloco B', 'Bela Vista', '01311000', 'SP', 'São Paulo', 'c');
INSERT INTO tbl_cadastro(usuario, email, telefone, senha, nome,cpf, rua, numero, complemento, bairro, cep, estado, cidade, tipo)
    VALUES ('carlosjunior90', 'carlos.junior@email.com', '31976543210', 'senhaSegura2024', 'Carlos Junior','20887668046', 'Rua das Palmeiras', '789', 'Casa', 'Vila Nova', '31560000', 'MG', 'Belo Horizonte', 'f');
INSERT INTO tbl_cadastro(usuario, email, telefone, senha, nome,cpf, rua, numero, complemento, bairro, cep, estado, cidade, tipo)
    VALUES ('anaoliveira22', 'ana.oliveira@email.com', '11999887766', 'minhaSenha2024', 'Ana Oliveira','85345366004', 'Rua dos Pinheiros', '101', 'Apt 12', 'Jardim Paulista', '01419001', 'SP', 'São Paulo', 'f');
INSERT INTO tbl_cadastro(usuario, email, telefone, senha, nome,cnpj, rua, numero,bairro, cep, estado, cidade, tipo)
    VALUES ('tomastrb','mecanicatomas@gmail.com','11998237328','tomastrb123','Mecanica Tomas Turbo','83545135000160','Jardim das flores','185','São Miguel','01123000','SP','São Paulo','m');
INSERT INTO tbl_cadastro(usuario, email, telefone, senha, nome,cnpj, rua, numero,bairro, cep, estado, cidade, tipo)
    VALUES ('garage360','garage360@gmail.com','11998223345','grg360','Garage 360','59019315000123','Av. Laranja','222','Colina','01123111','SP','São Paulo','m');


SELECT * FROM tbl_cadastro;



-- TABELA CLIENTES
CREATE TABLE tbl_clientes(
id_cadastro INTEGER NOT NULL,

CONSTRAINT tbl_clientes_pk PRIMARY KEY (id_cadastro),
CONSTRAINT cliente_id_cadastro_fk FOREIGN KEY (id_cadastro)
    REFERENCES tbl_cadastro (id_cadastro)
);

INSERT INTO tbl_clientes(id_cadastro)
    VALUES(1);
INSERT INTO tbl_clientes(id_cadastro)
    VALUES(2);
    
    
SELECT * FROM tbl_clientes;


-- TABELA MODELOS
CREATE TABLE tbl_modelos(
modelo VARCHAR(30),
marca VARCHAR(30) NOT NULL,
ano SMALLINT NOT NULL,
quilometragem INTEGER NOT NULL,

CONSTRAINT tbl_modelo_pk PRIMARY KEY (modelo)
);


INSERT INTO tbl_modelo(modelo,marca,ano,quilometragem)
    VALUES('Civic Si','Honda',2018,80000);
INSERT INTO tbl_modelo(modelo,marca,ano,quilometragem)
    VALUES('Lancer Evo IX','Mitsubishi',2000,140000);

SELECT * FROM tbl_modelo;



-- TABELA VEICULOS
CREATE TABLE tbl_veiculos (
placa CHAR(7) NOT NULL,
modelo VARCHAR(30),
marca VARCHAR(30) NOT NULL,
ano SMALLINT NOT NULL,
quilometragem INTEGER NOT NULL,
id_cadastro INTEGER NOT NULL,
dono VARCHAR(30) NOT NULL,

CONSTRAINT tbl_veiculos_pk PRIMARY KEY (placa),
CONSTRAINT id_veiculo_cadastro_fk FOREIGN KEY (id_cadastro)
    REFERENCES tbl_clientes (id_cadastro),
CONSTRAINT id_veiculo_modelo_fk FOREIGN KEY (modelo)
    REFERENCES tbl_modelo (modelo)
);

INSERT INTO tbl_veiculos (placa, id_cadastro, modelo, dono)
    VALUES ('ABC1234', 1, 'Civic Si', 'João Victor');
INSERT INTO tbl_veiculos (placa, id_cadastro, modelo, dono)
    VALUES ('XYZ9876', 2, 'Lancer Evo IX', 'Maria Silva');

SELECT * FROM tbl_veiculos;



-- TABELA DIAGNOSTICOS
CREATE TABLE tbl_diagnosticos(
id_diagnostico INTEGER GENERATED BY DEFAULT AS IDENTITY,
placa CHAR(7) NOT NULL,
problema_veiculo VARCHAR(100) NOT NULL,
relatorio VARCHAR(150) NOT NULL,

CONSTRAINT tbl_diagnosticos_pk PRIMARY KEY (id_diagnostico),
CONSTRAINT placa_fk FOREIGN KEY (placa)
    REFERENCES tbl_veiculos (placa)
);

INSERT INTO tbl_diagnosticos(id_diagnostico,placa,problema_veiculo,relatorio)
    VALUES(1,'ABC1234','Barulho roda dianteira esquerda','Carro apresentando barulho na roda dianteira esquerda ao passar por trepidações');
INSERT INTO tbl_diagnosticos(id_diagnostico,placa,problema_veiculo,relatorio)
    VALUES(2,'XYZ9876','Baixa pressão','Carro apresentando fraqueza ao ultrapassar 3000 rpm');
    
SELECT * FROM tbl_diagnosticos;



-- TABELA FUNCIONARIOS
CREATE TABLE tbl_funcionarios (
id_cadastro INTEGER NOT NULL,
cargo VARCHAR(30) NOT NULL,

CONSTRAINT tbl_funcionarios_pk PRIMARY KEY (id_cadastro),
CONSTRAINT funcionario_id_cadastro_fk FOREIGN KEY (id_cadastro)
    REFERENCES tbl_cadastro (id_cadastro)
);

INSERT INTO tbl_funcionarios(id_cadastro,cargo)
    VALUES(3,'gerente');
INSERT INTO tbl_funcionarios(id_cadastro,cargo)
    VALUES(4,'secretaria');   

SELECT * FROM tbl_funcionarios;



-- TABELA MECANICAS
CREATE TABLE tbl_mecanicas (
id_cadastro INTEGER NOT NULL,


CONSTRAINT tbl_mecanicas_pk PRIMARY KEY (id_cadastro),
CONSTRAINT mecanica_id_cadastro_fk FOREIGN KEY (id_cadastro)
    REFERENCES tbl_cadastro (id_cadastro)
);

INSERT INTO tbl_mecanicas(id_cadastro)
    VALUES(5);
INSERT INTO tbl_mecanicas(id_cadastro)
    VALUES(6);
    
SELECT * FROM tbl_mecanicas;



-- TABELA SERVICOS
CREATE TABLE tbl_servicos (
id_servico INTEGER GENERATED BY DEFAULT AS IDENTITY,
id_cadastro INTEGER NOT NULL,
placa CHAR(7) NOT NULL,
data_conserto DATE NOT NULL,
inicio_servico TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
fim_servico TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
pecas_trocadas VARCHAR(100) NOT NULL,
descricao VARCHAR(200) NOT NULL,

CONSTRAINT tbl_servicos_pk PRIMARY KEY (id_servico),
CONSTRAINT tbl_servicos_mecanica_fk FOREIGN KEY (id_cadastro)
    REFERENCES tbl_mecanicas (id_cadastro),
CONSTRAINT tbl_servicos_veiculo_fk FOREIGN KEY (placa)
    REFERENCES tbl_veiculos (placa)
);

INSERT INTO tbl_servicos(id_cadastro,placa,data_conserto,inicio_servico,fim_servico,pecas_trocadas,descricao)
    VALUES(5,'ABC1234',DATE '2024-08-31',TIMESTAMP '2024-08-31 13:30:23',TIMESTAMP '2024-08-31 17:20:14','Filtro de oleo + 4 litros de oleo','Troca de oleo e filtro em uma Fiat Touro');
INSERT INTO tbl_servicos(id_cadastro,placa,data_conserto,inicio_servico,fim_servico,pecas_trocadas,descricao)
    VALUES(6,'XYZ9876',DATE '2024-09-01',TIMESTAMP '2024-09-01 09:00:19',TIMESTAMP '2024-09-01 14:15:44','n/a','Revisão na caixa de transmissão Fiat Touro');

SELECT * From tbl_servicos;